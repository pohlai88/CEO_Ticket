# ============================================================================
# NEXUS UI GUARD â€” Constitutional Enforcement Pipeline
# ============================================================================
#
# This workflow enforces the NEXUS DESIGN CONSTITUTION across all code changes.
#
# Enforcement Scope:
# - Forbidden pattern detection (raw Tailwind colors, hex values, legacy AIBOS)
# - Semantic token usage validation
# - Design system drift prevention
#
# Governance Stack Integration:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ PRD_GUARD   â†’  Business logic compliance (prd-compliance.yml)          â”‚
# â”‚ UI_GUARD    â†’  Design token enforcement (this file)                    â”‚
# â”‚ E2E_GUARD   â†’  Three-layer verification (e2e-tests.yml)                â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# @see https://github.com/pohlai88/NEXUS_UI_GUARD
# ============================================================================

name: UI Guard Enforcement

on:
  push:
    branches: [main, develop]
    paths:
      - "app/**/*.tsx"
      - "app/**/*.css"
      - "components/**/*.tsx"
      - "app/globals.css"
      - "tailwind.config.ts"
  pull_request:
    branches: [main]
    paths:
      - "app/**/*.tsx"
      - "app/**/*.css"
      - "components/**/*.tsx"
      - "app/globals.css"
      - "tailwind.config.ts"

jobs:
  constitutional-check:
    name: Constitutional Enforcement
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: "ğŸš” NX-CHECK: Forbidden Pattern Scan"
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  NEXUS UI GUARD â€” Constitutional Enforcement"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "Scanning for forbidden patterns..."
          echo "  ğŸš« Raw Tailwind colors (bg-gray-*, text-blue-*, etc.)"
          echo "  ğŸš« Arbitrary hex values (bg-[#...], text-[#...])"
          echo "  ğŸš« Legacy AIBOS patterns (na-*, aibos)"
          echo ""
          npm run nx:check
        continue-on-error: false

      - name: "âš–ï¸ NX-VALIDATE: Token Integrity Check"
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  Validating Design Token Integrity"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          npm run nx:validate
        continue-on-error: true

      - name: "ğŸ“Š Report Summary"
        if: always()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "  UI GUARD ENFORCEMENT COMPLETE"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "  Constitutional Authority: NEXUS DESIGN CONSTITUTION v1.0.0"
          echo "  Governance Layer: UI_GUARD"
          echo "  Enforcement Level: BLOCKING"
          echo ""
          echo "  Any violations will prevent merge to protected branches."
          echo ""
